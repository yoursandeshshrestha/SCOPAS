generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model coupon {
  id         String   @id @unique
  code       String?
  version    Int?
  storeId    String
  platformId String
  details    String?
  updatedAt  DateTime @default(now()) @updatedAt
  platform   platform @relation(fields: [platformId], references: [id])
  store      store    @relation(fields: [storeId], references: [id])

  @@unique([code, storeId])
}

model platform {
  id      String   @id @unique
  name    String   @unique
  version Int
  coupon  coupon[]
  store   store[]
}

model refresh_tokens {
  id        String   @id
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model store {
  id         String   @id @unique
  name       String
  link       String
  platformId String
  coupon     coupon[]
  platform   platform @relation(fields: [platformId], references: [id])

  @@unique([name, platformId])
}

model users {
  id             String           @id
  email          String           @unique
  name           String?
  password       String?
  googleId       String?          @unique
  provider       String           @default("local")
  avatar         String?
  role           String           @default("user")
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  refresh_tokens refresh_tokens[]
}
